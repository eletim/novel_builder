{% extends "base.html" %}
{% set title = "一覧" %}
{% block content %}
<h1>シリーズ / 巻 / 章 一覧</h1>

<!-- ★ 新規チャプター作成ボックス -->
<div class="new-chapter-box">
  <div class="new-chapter-row">
    <label for="volumeSelect">巻を選択：</label>
    <select id="volumeSelect">
      {% for s in data %}
      <optgroup label="{{ s.name }}">
        {% for v in s.volumes %}
        <option
          value="{{ v.relpath }}"
          data-next="{{ v.next_ch or '' }}"
        >
          {{ v.name }}
        </option>
        {% endfor %}
      </optgroup>
      {% endfor %}
    </select>

    <span class="next-label">次に作成: <strong id="nextChLabel">—</strong></span>
    <button id="createChBtn" class="btn">＋ チャプター作成</button>
  </div>
  <small class="muted">チャプター名は <code>CH01</code> 〜 <code>CH99</code> の連番で自動採番されます。</small>
</div>

{% if not data %}
<p>フォルダが見つかりませんでした。<br>
<code>{{ root }}</code> に <code>series-*</code> / <code>vol-*</code> / <code>CH**-*</code> を作成してください。</p>
{% endif %}

<div class="tree">
  {% for s in data %}
  <details open>
    <summary class="series">{{ s.name }}</summary>
    {% for v in s.volumes %}
    <details open>
      <summary class="volume">{{ v.name }}</summary>
      <ul>
        {% for ch in v.chapters %}
        <li>
          <a class="chapter-link" href="{{ url_for('chapter', chapter_path=ch.relpath) }}">{{ ch.name }}</a>
        </li>
        {% endfor %}
      </ul>
    </details>
    {% endfor %}
  </details>
  {% endfor %}
</div>
{% endblock %}

{% extends "base.html" %}
{% set title = "一覧" %}
{% block content %}
<h1>シリーズ / 巻 / 章 一覧</h1>

<!-- ★ 新規チャプター作成ボックス -->
<div class="new-chapter-box">
  <div class="new-chapter-row">
    <label for="volumeSelect">巻を選択：</label>
    <select id="volumeSelect">
      {% for s in data %}
      <optgroup label="{{ s.title or s.name }}" data-path="{{ s.relpath }}">
        {% for v in s.volumes %}
        <option
          value="{{ v.relpath }}"
          data-path="{{ v.relpath }}"
        >
          {{ v.title or v.name }}
        </option>
        {% endfor %}
      </optgroup>
      {% endfor %}
    </select>

    <span class="next-label">次に作成: <strong id="nextChLabel">—</strong></span>
    <button id="createChBtn" class="btn">＋ チャプター作成</button>
  </div>
  <small class="muted">チャプター名は <code>CH01</code> 〜 <code>CH99</code> の連番で自動採番されます。</small>
</div>

{% if not data %}
<p>フォルダが見つかりませんでした。<br>
<code>{{ root }}</code> に <code>series-*</code> / <code>vol-*</code> / <code>CH**-*</code> を作成してください。</p>
{% endif %}

<div class="tree">
  {% for s in data %}
  <details open>
   <summary class="series" data-kind="series" data-path="{{ s.relpath }}">
     <span class="t-display">{{ s.title or s.name }}</span>
     <button type="button" class="btn btn-xs t-edit" aria-label="シリーズタイトルを編集">✏️</button>
     <input class="t-input" type="text" value="{{ s.title or '' }}" placeholder="シリーズタイトル" hidden>
   </summary>
    {% for v in s.volumes %}
    <details open>
      <summary class="volume">{{ v.title or v.name }}</summary>
      <ul>
        {% for ch in v.chapters %}
        <li data-kind="chapter" data-path="{{ ch.relpath }}">
          <a class="chapter-link" href="{{ url_for('chapter', chapter_path=ch.relpath) }}">{{ ch.title or ch.name }}</a>
          <button type="button" class="btn btn-xs t-edit" aria-label="章タイトルを編集">✏️</button>
          <input class="t-input" type="text" value="{{ ch.title or '' }}" placeholder="章タイトル" hidden>
        </li>
        {% endfor %}
      </ul>
    </details>
    {% endfor %}
  </details>
  {% endfor %}
</div>
{% endblock %}

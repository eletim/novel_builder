{% extends "base.html" %}
{% set title = "一覧" %}
{% block content %}
<h1>シリーズ / 巻 / 章 一覧</h1>

{% if not data %}
<p>フォルダが見つかりませんでした。<br>
<code>{{ root }}</code> に <code>series-*</code> / <code>vol-*</code> / <code>CH**-*</code> を作成してください。</p>
{% endif %}

<div class="tree">
  {% for s in data %}
  <details open>
   <summary class="series" data-kind="series" data-path="{{ s.relpath }}">
     <span class="t-display">{{ s.title or s.name }}</span>
     <button type="button" class="btn btn-xs t-edit" aria-label="シリーズタイトルを編集">✏️</button>
     <input class="t-input" type="text" value="{{ s.title or '' }}" placeholder="シリーズタイトル" hidden>
   </summary>
    {% for v in s.volumes %}
    <details open>
      <summary class="volume" data-kind="volume" data-path="{{ v.relpath }}">
        <span class="t-display">{{ v.title or v.name }}</span>
        <button type="button" class="btn btn-xs t-edit" aria-label="巻タイトルを編集">✏️</button>
        <input class="t-input" type="text" value="{{ v.title or '' }}" placeholder="巻タイトル" hidden>
      </summary>
      <ul>
        {% for ch in v.chapters %}
        <li data-kind="chapter" data-path="{{ ch.relpath }}">
          <a class="chapter-link" href="{{ url_for('chapter', chapter_path=ch.relpath) }}">{{ ch.title or ch.name }}</a>
          <button type="button" class="btn btn-xs t-edit" aria-label="章タイトルを編集">✏️</button>
          <input class="t-input" type="text" value="{{ ch.title or '' }}" placeholder="章タイトル" hidden>
        </li>
        {% endfor %}
      </ul>
      <div class="vol-create">
        <small class="muted">次に作成: <strong>{{ v.next_ch or "—" }}</strong></small>
        <button
          class="btn vol-create-btn"
          data-vol="{{ v.relpath }}"
          {% if not v.next_ch %}disabled title="この巻はCH99まで埋まっています"{% endif %}
        >＋ チャプター作成</button>
      </div>
    </details>
    {% endfor %}
  </details>
  {% endfor %}
</div>
{% endblock %}

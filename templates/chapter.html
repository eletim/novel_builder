{% extends "base.html" %}
{% set title = chapter_name %}
{% block header_right %}
<div class="actions">
  <a class="btn" href="{{ url_for('chapter_single', chapter_path=chapter_path) }}">個別表示</a>
  <button id="saveAllBtn" class="btn">💾 すべて保存（Ctrl+S）</button>
  <label class="notes-toggle"><input type="checkbox" id="toggleNotes"> notes を表示</label>
</div>
{% endblock %}

{% block content %}
<!-- <h1>{{ chapter_name }}</h1>
<p class="muted">{{ chapter_path }}</p> -->

<!-- ★ 上：前チャプター -->
<div class="vnav vnav-top">
  <a class="nav-arrow" aria-label="前の章へ (↑)"
     href="{{ url_for('chapter', chapter_path=prev_chapter) }}">
    <svg class="icon" aria-hidden="true"><use href="#i-chevron-up"></use></svg>
    <span class="sr-only">前の章</span>
  </a>
  <small class="muted" style="margin-left:6px;">↑ / 前のチャプター</small>
</div>

<div class="grid4" id="editorGrid" data-chapter="{{ chapter_path }}">
  {% for f in files %}
  <section class="pane" data-filename="{{ f.filename }}">
    <header class="pane-head">
      <div class="pane-title">
        <strong>{{ chapter_name }}</strong>
        <span>-</spap>
        <strong>{{ f.label }}</strong>
        <span class="file">{{ f.filename }}</span>
        <span class="dirty" hidden>●未保存</span>
      </div>
      <div class="pane-tools">
        <button class="btn btn-save">保存</button>
      </div>
    </header>
    <textarea class="editor" spellcheck="false">{{ f.content }}</textarea>
  </section>
  {% endfor %}
</div>

<!-- ★ 下：次チャプター -->
<div class="vnav vnav-bottom" style="margin-top:8px;">
  <a class="nav-arrow" aria-label="次の章へ (↓)"
     href="{{ url_for('chapter', chapter_path=next_chapter) }}">
    <svg class="icon" aria-hidden="true"><use href="#i-chevron-down"></use></svg>
    <span class="sr-only">次の章</span>
  </a>
  <small class="muted" style="margin-left:6px;">↓ / 次のチャプター</small>
</div>

<details id="notesWrap" class="notes" open hidden>
  <summary>notes.md</summary>
  <section class="pane" data-filename="notes.md">
    <header class="pane-head">
      <div class="pane-title">
        <strong>Notes</strong>
        <span class="file">notes.md</span>
        <span class="dirty" hidden>●未保存</span>
      </div>
      <div class="pane-tools">
        <button class="btn btn-save">保存</button>
      </div>
    </header>
    <textarea class="editor" spellcheck="false" wrap="soft">{{ notes }}</textarea>
  </section>
</details>

<div id="toast" class="toast" hidden></div>
{% endblock %}

{% block scripts %}
<script>
  window.__CHAPTER_PATH__ = "{{ chapter_path }}";
  // ★ JS用：上下移動URL
  window.__GRID_NAV__ = {
    prevChapterUrl: "{{ url_for('chapter', chapter_path=prev_chapter) }}",
    nextChapterUrl: "{{ url_for('chapter', chapter_path=next_chapter) }}"
  };
</script>
{% endblock %}
